---
import Layout from "../layouts/Layout.astro";
import InteriorBlueprint from "../components/PageBlueprints/InteriorBlueprint.astro";
import IndexBlueprint from "../components/PageBlueprints/IndexBlueprint.astro";
import ContactBlueprint from "../components/PageBlueprints/ContactBlueprint.astro";
import { sanityClient } from "sanity:client";
import { pageQuery, fellowsAllQuery } from "../lib/sanity.queries";
import type { PagePayload, Fellow } from "../types";

export async function getStaticPaths() {
  const pagesList = await sanityClient.fetch<PagePayload[]>(pageQuery, {
    page: "page",
    fellowshipYear: 2024,
  });

  return pagesList.map((page) => {
    return {
      params: { slug: `${page.slug}` },
      props: { page },
    };
  });
}

const fellows = await sanityClient.fetch<Fellow[]>(fellowsAllQuery);

type Props = {
  page: PagePayload;
};

const { page } = Astro.props;
// console.log(page);
---

<Layout>
  <main slot="content">
    <>
      {
        () => {
          switch (page.blueprint) {
            case "interior":
              return <InteriorBlueprint page={page} />;
            case "index":
              return (
                <IndexBlueprint
                  page={page}
                  content={page.slug === "fellows" ? fellows : undefined}
                />
              );
            case "contact":
              return <ContactBlueprint page={page} />;
          }
        }
      }
    </>
  </main>
</Layout>
